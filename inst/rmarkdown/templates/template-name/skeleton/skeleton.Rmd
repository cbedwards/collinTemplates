---
title: "Untitled"
author: "Author Name"
date: "`r format(Sys.time(), '%d %B, %Y')`"
output: 
  html_document:
    toc: true
    toc_float: true
    code_folding: hide
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Libraries

```{r}
library(viridis) #package for colors
library(here) #package for handling file paths easily
library(beepr) #package for making sound to let me know things are done. Not important for document compile, but useful for running time-consuming loops or tasks.
```


## Function definitions

### Standard Collin functions

```{r}
## function for turning DOY to month-day for visualization
doy_2md=function(i){
  ymd=as.Date(i-1, origin="2019-01-01")
  return(format(ymd, "%B %d"))
}
## example usage:
# #generate 30 observations from day of year 40 to 150
# doy=sample(40:150,30)
# #generate gaussian counts with noise
# count=exp(-(doy-100)^2/100)+(runif(30)-.5)*.1
# plot(doy,count)
# # now plot with day-month references
# plot(doy,count, xaxt="n")
# #Make sequence of days to label. Here, 5 days from day 40 to 150
# at=round(seq(40,150, length=5))
# axis(1,at=at, labels=doy_2md(at))



## Function for making figs with metadata. Note: you will want to change figfold and scriptname default values to be appropriate for this document.
fig_starter=function(filename, #name of figure file to save as WITHOUT SUFFIX
                   description, #vector of strings, each will be put in its own line of meta file
                   ##  Note: generating file is defined in the function, date and time is automatically added.
                   ##default figure info:
                   width=12,
                   height=8,
                   units="in",
                   res=300,
                   figfold="5_figs",
                   scriptname="BCB_analysis_v1.0.Rmd"
                   ){
  #function to automate making a jpeg figure (can change code here to make png)
  #and also add meta text
  #NOTE: still have to use dev.off() at the end of plot-making
  
  ## save meta file
  cat(c(description,
      "",##easy way to add an extra line to separate description for basic data.
      paste("from",scriptname),
      as.character(Sys.time())),
    sep="\n",
    file=here(figfold, paste(filename,"_meta.txt", sep=""))
    )
  
  ## open jpeg device
  jpeg(file=here(figfold,paste(filename,".jpg", sep="")),
     width=width, 
     height=height, 
     units=units, 
     res=res)
}
## Example usage:
# fig_starter(filename="testfig", description=c("This figure was made as an example.","We can add endless lines of description."))
# plot(1:10,1:10, pch=1:10)
# dev.off()
## Note: in this case the example will not work for you unless you give it the correct location for "figfold" - the relative file path to the folder for your figures.

## Function for making color gradient in R
color.gradient <- function(x, colors=viridis(256), colsteps=100) {
  return( colorRampPalette(colors) (colsteps) [ findInterval(x, seq(min(x),max(x), length.out=colsteps)) ] )
}
## Example usage:
#x=runif(100)
#plot(x=x, y=1/x, pch=19,col=color.gradient(x),
#     cex.lab=1.6, main="Example of color gradient")



## function for making semi-transparent colors
t_col <- function(color, alpha = 1, name = NULL) {
  #	  color = color name
  #	  alpha = fraction of opacity
  #	   name = an optional name for the color
  ## Get RGB values for named color
  rgb.val <- col2rgb(color)
  ## Make new color using input color as base and alpha set by transparency
  t.col <- rgb(rgb.val[1], rgb.val[2], rgb.val[3],
               max = 255,
               alpha = alpha*255,
               names = name)
  ## Save the color
  invisible(t.col)
}
## example usage:
# library(plotrix)
#plot(c(1,2),c(1,2),type='l')
#red.t = t_col(color="red", alpha=.5)
#draw.circle(x=1.5, y=1.5, radius=.2, col=red.t)



## Functions for making pair plots
panel.hist <- function(x, ...){
# histogram function
  usr <- par("usr"); on.exit(par(usr))
  par(usr = c(usr[1:2], 0, 1.5) )
  h <- hist(x, plot = FALSE, breaks=20)
  breaks <- h$breaks; nB <- length(breaks)
  y <- h$counts; y <- y/max(y)
  rect(breaks[-nB], 0, breaks[-1], y, col = "cyan", ...)
}
panel.cor <- function(x, y,
                      digits = 2,
                      prefix = "",
                      cex.cor,
                      ...){
  # function to plot pairwise correlations
  usr <- par("usr"); on.exit(par(usr))
  par(usr = c(0, 1, 0, 1))
  r <- abs(cor(x, y, use="complete.obs"))
  rsigned=cor(x, y, use="complete.obs")
  p = cor.test(x, y, use="complate.obs")$p.value
  txt <- format(c(rsigned, 0.123456789), digits = digits)[1]
  txt <- paste0(prefix, txt)
  if(missing(cex.cor)) cex.cor <- 0.8/strwidth(txt)
  col="grey"
  if(p<.1){col="black"}
  if(p<.05){col="blue"}
  text(0.5, 0.5, txt, cex = cex.cor *(r+.2)/(r+1), col=col)
}
panel.cortest = function(x,y,
                         digits=2,
                         prefix="",
                         cex.cor,
                         ...){
  #function to plot p value of correlations
  usr <- par("usr"); on.exit(par(usr))
  par(usr = c(0, 1, 0, 1))
  p <- signif(cor.test(x, y, use="complete.obs")$p.value,2)
  if(missing(cex.cor)) cex.cor <- 2
  col="grey"
  if(p<.1){col="black"}
  if(p<.05){col="blue"}
  text(.5, .5, p, cex=cex.cor, col=col)

}
## example usage:
# x=runif(100)
# dat=data.frame(x=x,y=x+.5+rnorm(100)*.1, z=x + rnorm(100))
# pairs(dat,
#       lower.panel=panel.cor,
#       diag.panel=panel.hist)
# pairs(dat,
#     lower.panel=panel.cortest,
#     diag.panel=panel.hist,
#     upper.panel=panel.cor)

## Function for taking a vector of strings in R and displaying it as bullets in Rmarkdown
## Note that the chunk needs to be given the argument of results='asis'
printer=function(x){
## x needs to be a vector of strings.
  com=as.character(x)
  com=com[com!=""]
  com=gsub("\n","",com)
  cat(paste('-', com), sep = '\n') 
}
# example usage:
# ```{r results='asis'}
#    printer(1:3)
# ```



fig_starter=function(filename, #name of figure file to save as WITHOUT SUFFIX
                     description, #vector of strings, each will be put in its own line of meta file
                     ##  Note: generating file is defined in the function, date and time is automatically added.
                     ##default figure info:
                     width=12,
                     height=8,
                     units="in",
                     res=300,
                     figfold="5_figs",
                     scriptname="BCB_analysis_v1.2.Rmd"
){
  #function to automate making a jpeg figure (can change code here to make png)
  #and also add meta text
  #NOTE: still have to use dev.off() at the end of plot-making
  
  ## save meta file
  cat(c(description,
        "",##easy way to add an extra line to separate description for basic data.
        paste("from",scriptname),
        as.character(Sys.time())),
      sep="\n",
      file=here(figfold, paste(filename,"_meta.txt", sep=""))
  )
  
  ## open jpeg device
  jpeg(file=here(figfold,paste(filename,".jpg", sep="")),
       width=width, 
       height=height, 
       units=units, 
       res=res)
}

gfig_saver=function(gfig, #object to be saved
                    filename, #name of figure file to save as WITHOUT SUFFIX
                    description, #vector of strings, each will be put in its own line of meta file
                    ##  Note: generating file is defined in the function, date and time is automatically added.
                    ##default figure info:
                    width=12,
                    height=8,
                    units="in",
                    figfold="5_figs",
                    scriptname="BCB_analysis_v1.2.Rmd"
){
  ## save meta file
  cat(c(description,
        "",##easy way to add an extra line to separate description for basic data.
        paste("from",scriptname),
        as.character(Sys.time())),
      sep="\n",
      file=here(figfold, paste(filename,"_meta.txt", sep=""))
  )
  ggsave(filename=here(figfold, paste(filename,".jpg", sep="")),
         plot=gfig,
         device="jpeg",
         width=width, height=height, units=units
  )
}
```

### Document-specific functions

```{r}

```



# [something something main document sections]
